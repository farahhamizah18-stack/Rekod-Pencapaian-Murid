
<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rekod Kokurikulum SJKC Chi Chih</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
    .animate-fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .input-field { width: 100%; border: 2.5px solid #f1f5f9; padding: 16px; border-radius: 16px; font-weight: 700; outline: none; transition: all 0.2s; background: #f8fafc; }
    .input-field:focus { border-color: #001f3f; background: white; box-shadow: 0 8px 20px -10px rgba(0,31,63,0.3); }
    .glass-nav { background: rgba(0, 31, 63, 0.95); backdrop-filter: blur(10px); }
    
    .font-chinese { font-family: "Kaiti", "Ê•∑‰Ωì", "STKaiti", serif; }
    .font-arial { font-family: Arial, sans-serif; }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { jsPDF } = window.jspdf;

    const DEFAULT_SPREADSHEET_ID = '1y62616eZuUGWqV75Y_D9m7UPQXx9IldR1kR7szLu1Bo';
    const FOLDER_DRIVE_ID = '16nQ_z_MLOhp09i6BsHqrCVdlmQMNkU2';
    const DEFAULT_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMkyH6bF-b1pi0P3Q8ZQ8_DBmt8kK1hvFuy6GmLRHtAZkeePk94loquB-jUKsM2jlc/exec';
    const LOGO_URL = 'https://i.postimg.cc/VsW3PJMS/logo-sekolah.jpg';

    const Peringkat = {
      SEKOLAH: 'Sekolah',
      DAERAH: 'Daerah',
      NEGERI: 'Negeri',
      KEBANGSAAN: 'Kebangsaan'
    };

    const isChinese = (char) => /[\u4E00-\u9FFF]/.test(char);

    const App = () => {
      const [view, setView] = useState('form');
      const [isAdmin, setIsAdmin] = useState(false);
      const [showLogin, setShowLogin] = useState(false);
      const [password, setPassword] = useState('');
      const [isSending, setIsSending] = useState(false);
      const [scriptUrl, setScriptUrl] = useState(localStorage.getItem('sjkc_script_url') || DEFAULT_SCRIPT_URL);
      const [totalSubmissions, setTotalSubmissions] = useState(parseInt(localStorage.getItem('sjkc_total') || '0'));
      const [logoBase64, setLogoBase64] = useState('');

      const [formData, setFormData] = useState({
        peringkat: Peringkat.SEKOLAH,
        namaPertandingan: '',
        tarikh: '',
        anjuran: '',
        tempat: '',
        guruPengiring: '',
        kategori: '',
        peserta: [{ id: Date.now(), nama: '', tahun: '', pencapaian: '' }],
        gambar: []
      });

      useEffect(() => {
        localStorage.setItem('sjkc_script_url', scriptUrl);
      }, [scriptUrl]);

      useEffect(() => {
        localStorage.setItem('sjkc_total', totalSubmissions);
      }, [totalSubmissions]);

      useEffect(() => {
        const img = new Image();
        img.crossOrigin = 'Anonymous';
        img.src = LOGO_URL;
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0);
          setLogoBase64(canvas.toDataURL('image/jpeg'));
        };
      }, []);

      const handleImageUpload = (e) => {
        const files = Array.from(e.target.files);
        const remainingSlots = 2 - formData.gambar.length;
        if (remainingSlots <= 0) {
          alert("Maksimum 2 keping gambar sahaja dibenarkan.");
          return;
        }
        const filesToProcess = files.slice(0, remainingSlots);
        filesToProcess.forEach(file => {
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData(prev => ({ ...prev, gambar: [...prev.gambar, reader.result] }));
          };
          reader.readAsDataURL(file);
        });
      };

      /**
       * Fungsi untuk melukis teks bercampur (Latin & Cina) dalam PDF.
       * Saiz fon Cina ditetapkan kepada 12pt mengikut permintaan.
       * Menggunakan canvas untuk ketepatan visual simbol Cina.
       */
      const drawMixedText = (doc, text, x, y, size = 11, isBold = false, align = 'left', columnWidth = 0) => {
        if (!text) return;
        const segments = text.match(/[\u4E00-\u9FFF]+|[^\u4E00-\u9FFF]+/g) || [];
        
        const chineseFontSize = 12; // Saiz spesifik untuk simbol cina
        const scaleFactor = 4; // Untuk kualiti render canvas yang lebih tajam

        // Pengiraan Lebar Keseluruhan Segmen (untuk alignment)
        let totalWidthMm = 0;
        const computedSegments = segments.map(segment => {
          const isChin = isChinese(segment[0]);
          if (isChin) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.font = `${isBold ? 'bold' : 'normal'} ${chineseFontSize * scaleFactor}px "Kaiti", "Ê•∑‰Ωì", "STKaiti", serif`;
            const widthPx = tempCtx.measureText(segment).width;
            const widthMm = (widthPx / scaleFactor) * (25.4 / 72); // Convert points to mm
            totalWidthMm += widthMm;
            return { segment, isChin, widthMm };
          } else {
            doc.setFont('helvetica', isBold ? 'bold' : 'normal');
            doc.setFontSize(size);
            const widthMm = doc.getTextWidth(segment);
            totalWidthMm += widthMm;
            return { segment, isChin, widthMm };
          }
        });

        let currentX = x;
        if (align === 'center' && columnWidth > 0) {
          currentX = x + (columnWidth - totalWidthMm) / 2;
        }

        computedSegments.forEach(item => {
          if (item.isChin) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const fontSizePx = chineseFontSize * scaleFactor;
            ctx.font = `${isBold ? 'bold' : 'normal'} ${fontSizePx}px "Kaiti", "Ê•∑‰Ωì", "STKaiti", serif`;
            
            const metrics = ctx.measureText(item.segment);
            const textWidthPx = metrics.width;
            const textHeightPx = fontSizePx * 1.3;
            
            canvas.width = textWidthPx;
            canvas.height = textHeightPx;
            
            ctx.font = `${isBold ? 'bold' : 'normal'} ${fontSizePx}px "Kaiti", "Ê•∑‰Ωì", "STKaiti", serif`;
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#000000';
            ctx.fillText(item.segment, 0, textHeightPx / 2);
            
            const imgData = canvas.toDataURL('image/png');
            const mmHeight = (chineseFontSize * (25.4 / 72)) * 1.2;
            
            // Baseline adjustment: Sedikit ke atas untuk selari dengan Latin
            doc.addImage(imgData, 'PNG', currentX, y - (chineseFontSize * 0.28), item.widthMm, mmHeight, undefined, 'FAST');
            currentX += item.widthMm;
          } else {
            doc.setFont('helvetica', isBold ? 'bold' : 'normal'); 
            doc.setFontSize(size);
            doc.text(item.segment, currentX, y);
            currentX += item.widthMm;
          }
        });
      };

      const generatePDF = async (rekod) => {
        const doc = new jsPDF('p', 'mm', 'a4');
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 15;
        let y = 15;

        if (logoBase64) {
          try {
            doc.addImage(logoBase64, 'JPEG', (pageWidth / 2) - 15, y, 30, 30);
            y += 35;
          } catch (e) { y += 5; }
        }

        doc.setFont('helvetica', 'bold').setFontSize(12);
        doc.text("REKOD PENGLIBATAN DAN PENCAPAIAN KOKURIKULUM,", pageWidth / 2, y, { align: 'center' }); y += 6;
        doc.text("SUKAN DAN KO-AKADEMIK SJKC CHI CHIH", pageWidth / 2, y, { align: 'center' }); y += 8;
        doc.setLineWidth(0.5).setDrawColor(0).line(margin, y, pageWidth - margin, y); y += 8;

        const labels = ["Peringkat", "Pertandingan", "Tarikh", "Anjuran", "Tempat", "Guru Pengiring", "Kategori"];
        const values = [rekod.peringkat, rekod.namaPertandingan, rekod.tarikh, rekod.anjuran, rekod.tempat, rekod.guruPengiring || "-", rekod.kategori || "-"];
        
        labels.forEach((label, i) => {
          drawMixedText(doc, label + ":", margin, y, 11, true);
          drawMixedText(doc, String(values[i]), margin + 45, y, 11, false);
          y += 6.5;
        });

        y += 2;
        drawMixedText(doc, "SENARAI NAMA MURID DAN PENCAPAIAN", margin, y, 11, true); y += 5;

        // Definisi Lebar Lajur (Total 180mm)
        const colW = {
          no: 10,
          nama: 125,
          tahun: 15,
          pencapaian: 30
        };
        const tableX = margin;
        const tableW = pageWidth - (margin * 2);
        const rowH = 8.5; 
        
        doc.setFillColor(240, 240, 240).rect(tableX, y, tableW, rowH, 'F');
        doc.setDrawColor(80, 80, 80).rect(tableX, y, tableW, rowH);
        doc.setFont('helvetica', 'bold').setFontSize(9);
        
        // Header Jadual - Alignment Center untuk No, Tahun, Pencapaian
        doc.text("NO", tableX + colW.no/2, y + 5.5, { align: 'center' });
        doc.text("NAMA MURID", tableX + colW.no + 3, y + 5.5);
        doc.text("TAHUN", tableX + colW.no + colW.nama + colW.tahun/2, y + 5.5, { align: 'center' });
        doc.text("PENCAPAIAN", tableX + colW.no + colW.nama + colW.tahun + colW.pencapaian/2, y + 5.5, { align: 'center' });
        y += rowH;

        rekod.peserta.forEach((p, idx) => {
          doc.setDrawColor(200).rect(tableX, y, tableW, rowH);
          
          // Lajur NO (Center)
          drawMixedText(doc, String(idx + 1), tableX, y + 5.5, 10, false, 'center', colW.no);
          
          // Lajur NAMA (Left)
          drawMixedText(doc, p.nama, tableX + colW.no + 3, y + 5.5, 10, false);
          
          // Lajur TAHUN (Center)
          drawMixedText(doc, p.tahun, tableX + colW.no + colW.nama, y + 5.5, 10, false, 'center', colW.tahun);
          
          // Lajur PENCAPAIAN (Center)
          drawMixedText(doc, p.pencapaian, tableX + colW.no + colW.nama + colW.tahun, y + 5.5, 10, false, 'center', colW.pencapaian);
          
          y += rowH;
        });

        if (rekod.gambar.length > 0) {
          y += 6;
          const footerLimit = pageHeight - 15;
          const remainingH = footerLimit - y;
          drawMixedText(doc, "LAMPIRAN GAMBAR", margin, y, 11, true); y += 6;
          const maxImgH = Math.max(remainingH - 10, 40);

          if (rekod.gambar.length === 1) {
            const imgBase64 = rekod.gambar[0];
            try {
              const imgProps = doc.getImageProperties(imgBase64);
              const ratio = imgProps.width / imgProps.height;
              let dW = tableW * 0.85;
              let dH = dW / ratio;
              if (dH > maxImgH) { dH = maxImgH; dW = dH * ratio; }
              doc.addImage(imgBase64, 'JPEG', margin + (tableW - dW)/2, y, dW, dH, undefined, 'FAST');
            } catch (e) { console.error(e); }
          } else {
            const spacingX = 5;
            const boxW = (tableW - spacingX) / 2;
            rekod.gambar.forEach((imgBase64, index) => {
              const posX = margin + (index * (boxW + spacingX));
              try {
                const imgProps = doc.getImageProperties(imgBase64);
                const ratio = imgProps.width / imgProps.height;
                let dW = boxW;
                let dH = boxW / ratio;
                if (dH > maxImgH) { dH = maxImgH; dW = dH * ratio; }
                doc.addImage(imgBase64, 'JPEG', posX + (boxW - dW)/2, y, dW, dH, undefined, 'FAST');
              } catch (e) { console.error(e); }
            });
          }
        }
        return doc;
      };

      const handlePreviu = async () => {
        setIsSending(true);
        try {
          const doc = await generatePDF(formData);
          const pdfBlob = doc.output('bloburl');
          window.open(pdfBlob, '_blank');
        } catch (err) {
          alert("Gagal menjana previu.");
        } finally {
          setIsSending(false);
        }
      };

      const handleHantarLaporan = async (e) => {
        if(e) e.preventDefault();
        if (!scriptUrl) { alert("Sila periksa URL Apps Script di Panel Admin."); return; }
        
        setIsSending(true);
        const newRecord = { ...formData };
        
        try {
          const doc = await generatePDF(newRecord);
          const pdfBase64 = doc.output('datauristring').split(',')[1];
          const payload = {
            action: "uploadPDF",
            fileName: `LAPORAN_${newRecord.namaPertandingan.replace(/[^a-z0-9]/gi, '_').toUpperCase()}_${newRecord.tarikh}.pdf`,
            pdfData: pdfBase64,
            folderId: FOLDER_DRIVE_ID,
            spreadsheetId: DEFAULT_SPREADSHEET_ID,
            sheetName: newRecord.peringkat,
            rowData: [
              newRecord.tarikh, newRecord.peringkat, newRecord.namaPertandingan,
              newRecord.anjuran, newRecord.tempat, newRecord.guruPengiring,
              newRecord.kategori,
              newRecord.peserta.map(p => `${p.nama} (${p.tahun}: ${p.pencapaian})`).join(', ')
            ]
          };
          await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
          setTotalSubmissions(prev => prev + 1);
          setView('success');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (err) {
          alert("Gagal menghantar rekod.");
        } finally {
          setIsSending(false);
        }
      };

      const loginAdmin = () => {
        if (password === 'admin1') { setIsAdmin(true); setShowLogin(false); setPassword(''); }
        else { alert("Akses dinafikan."); }
      };

      const resetBorang = () => {
        if(confirm("Mulakan borang baru? Data sedia ada akan dikosongkan.")) {
          setFormData({
            peringkat: Peringkat.SEKOLAH, namaPertandingan: '', tarikh: '', anjuran: '', tempat: '', guruPengiring: '', kategori: '',
            peserta: [{ id: Date.now(), nama: '', tahun: '', pencapaian: '' }], gambar: []
          });
          setView('form');
        }
      };

      return (
        <div className="min-h-screen flex flex-col pb-24 selection:bg-blue-100">
          <nav className="glass-nav text-white p-4 sticky top-0 z-50 shadow-2xl border-b-4 border-yellow-400">
            <div className="max-w-4xl mx-auto flex items-center justify-between">
              <div className="flex items-center gap-4">
                <img src={LOGO_URL} className="w-12 h-12 rounded-lg bg-white p-1" />
                <div>
                  <h1 className="text-xl font-black text-yellow-400 tracking-tight leading-none uppercase">SJKC CHI CHIH</h1>
                  <p className="text-[10px] font-bold tracking-[0.2em] text-slate-300 uppercase mt-1">Sistem Rekod Kokurikulum</p>
                </div>
              </div>
            </div>
          </nav>

          <main className="flex-grow max-w-5xl mx-auto w-full p-4 md:p-8">
            {view === 'form' && (
              <div className="animate-fade-in bg-white p-6 md:p-10 rounded-[2.5rem] shadow-2xl border border-slate-100">
                <header className="mb-10 border-b-4 border-yellow-400 pb-4 text-center md:text-left">
                  <h2 className="text-2xl font-black text-blue-950 uppercase tracking-tight inline-flex items-center gap-3">
                    <span className="bg-blue-950 text-white w-8 h-8 rounded-lg flex items-center justify-center text-sm">1</span>
                    MAKLUMAT REKOD PENGLIBATAN
                  </h2>
                </header>
                
                <form className="space-y-8">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <InputWrapper label="Peringkat Penglibatan">
                      <select className="input-field" value={formData.peringkat} onChange={e => setFormData({...formData, peringkat: e.target.value})}>
                        {Object.values(Peringkat).map(p => <option key={p} value={p}>{p}</option>)}
                      </select>
                    </InputWrapper>
                    <InputWrapper label="Nama Pertandingan / Aktiviti">
                      <input required className="input-field" type="text" value={formData.namaPertandingan} onChange={e => setFormData({...formData, namaPertandingan: e.target.value})} placeholder="Cth: Pertandingan Robotik" />
                    </InputWrapper>
                    <InputWrapper label="Tarikh Kejadian">
                      <input required className="input-field" type="date" value={formData.tarikh} onChange={e => setFormData({...formData, tarikh: e.target.value})} />
                    </InputWrapper>
                    <InputWrapper label="Penganjur / Organisasi">
                      <input required className="input-field" type="text" value={formData.anjuran} onChange={e => setFormData({...formData, anjuran: e.target.value})} placeholder="Cth: KPM / JPN" />
                    </InputWrapper>
                    <InputWrapper label="Tempat / Lokasi">
                      <input required className="input-field" type="text" value={formData.tempat} onChange={e => setFormData({...formData, tempat: e.target.value})} placeholder="Cth: Dewan Sekolah" />
                    </InputWrapper>
                    <InputWrapper label="Guru Pengiring">
                      <input className="input-field" type="text" value={formData.guruPengiring} onChange={e => setFormData({...formData, guruPengiring: e.target.value})} placeholder="Nama Guru" />
                    </InputWrapper>
                    <InputWrapper label="Kategori">
                      <input className="input-field" type="text" value={formData.kategori} onChange={e => setFormData({...formData, kategori: e.target.value})} placeholder="Cth: Individu / Kumpulan" />
                    </InputWrapper>
                  </div>

                  <div className="bg-slate-50 p-4 md:p-8 rounded-[2rem] border border-slate-200">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                      <h3 className="font-black text-blue-950 text-lg uppercase tracking-tight">Senarai Murid & Pencapaian</h3>
                      <button type="button" onClick={() => setFormData({...formData, peserta: [...formData.peserta, { id: Date.now(), nama: '', tahun: '', pencapaian: '' }]})} className="bg-blue-950 text-yellow-400 px-6 py-3 rounded-2xl font-black text-xs uppercase shadow-xl hover:bg-blue-900 transition-all flex items-center gap-2">
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M12 4v16m8-8H4"></path></svg>
                        Tambah Murid
                      </button>
                    </div>
                    <div className="space-y-4">
                      {formData.peserta.map((p, idx) => (
                        <div key={p.id} className="grid grid-cols-1 md:grid-cols-12 gap-3 items-center bg-white p-5 rounded-3xl border border-slate-200 shadow-sm hover:border-blue-300 transition-all">
                          <div className="md:col-span-1 text-sm font-black text-slate-300 text-center">{idx+1}</div>
                          <div className="md:col-span-6">
                            <label className="text-[9px] uppercase font-bold text-slate-400 ml-1">Nama Murid</label>
                            <input required className="w-full p-2 border-b border-slate-100 focus:border-blue-950 outline-none font-bold text-sm bg-transparent" placeholder="Cth: ALI BIN ABU / Âº†‰∏â" value={p.nama} onChange={e => setFormData({...formData, peserta: formData.peserta.map(x => x.id === p.id ? {...x, nama: e.target.value} : x)})} />
                          </div>
                          <div className="md:col-span-2">
                            <label className="text-[9px] uppercase font-bold text-slate-400 ml-1">Tahun</label>
                            <input required className="w-full p-2 border-b border-slate-100 focus:border-blue-950 outline-none font-bold text-sm bg-transparent" placeholder="Cth: 4B" value={p.tahun} onChange={e => setFormData({...formData, peserta: formData.peserta.map(x => x.id === p.id ? {...x, tahun: e.target.value} : x)})} />
                          </div>
                          <div className="md:col-span-2">
                             <label className="text-[9px] uppercase font-bold text-slate-400 ml-1">Pencapaian</label>
                             <input required className="w-full p-2 border-b border-slate-100 focus:border-blue-950 outline-none font-bold text-sm text-blue-700 bg-transparent" placeholder="Johan / Peserta" value={p.pencapaian} onChange={e => setFormData({...formData, peserta: formData.peserta.map(x => x.id === p.id ? {...x, pencapaian: e.target.value} : x)})} />
                          </div>
                          <div className="md:col-span-1 flex justify-center pt-3 md:pt-0">
                            <button type="button" onClick={() => setFormData({...formData, peserta: formData.peserta.filter(x => x.id !== p.id)})} className="text-red-400 hover:text-red-600 font-bold p-2 bg-red-50 rounded-full hover:scale-110 transition-all">
                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-white p-10 rounded-[2.5rem] border-4 border-dashed border-slate-200 text-center group hover:border-blue-950 transition-all">
                    <label className="cursor-pointer block">
                      <div className="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform text-3xl">üì∏</div>
                      <h4 className="text-lg font-black text-blue-950 uppercase mb-2">Muat Naik Gambar</h4>
                      <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Maksimum 2 Keping (Laporan 1 Muka Surat Sahaja)</p>
                      <input type="file" multiple className="hidden" accept="image/*" onChange={handleImageUpload} disabled={formData.gambar.length >= 2} />
                    </label>
                    <div className="flex flex-wrap gap-4 mt-8 justify-center">
                      {formData.gambar.map((img, i) => (
                        <div key={i} className="relative group/img animate-fade-in">
                           <img src={img} className="w-24 h-24 rounded-[1rem] object-cover border-4 border-white shadow-xl" />
                           <button type="button" onClick={() => setFormData({...formData, gambar: formData.gambar.filter((_, idx) => idx !== i)})} className="absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full shadow-lg flex items-center justify-center border-2 border-white font-bold text-xs">√ó</button>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4">
                    <button type="button" onClick={handlePreviu} disabled={isSending} className="py-6 rounded-3xl font-black text-sm border-4 border-blue-950 text-blue-950 hover:bg-blue-50 transition-all uppercase tracking-widest flex items-center justify-center gap-2 shadow-xl">
                      <span className="text-xl">üëÅÔ∏è</span> Previu PDF
                    </button>
                    <button type="button" onClick={handleHantarLaporan} disabled={isSending} className={`py-6 rounded-3xl font-black text-sm shadow-2xl transition-all uppercase tracking-widest flex items-center justify-center gap-3 ${isSending ? 'bg-slate-300 cursor-not-allowed text-slate-500' : 'bg-blue-950 text-yellow-400 hover:bg-blue-900 active:scale-95'}`}>
                      {isSending ? <div className="w-5 h-5 border-4 border-white border-t-transparent animate-spin rounded-full"></div> : <span className="text-xl">‚òÅÔ∏è</span>}
                      Hantar Rekod ke GD
                    </button>
                  </div>
                </form>
              </div>
            )}

            {view === 'success' && (
              <div className="animate-fade-in text-center space-y-10 py-24 bg-white rounded-[3rem] shadow-2xl border p-12">
                <div className="w-32 h-32 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6 text-7xl animate-bounce">üìÅ</div>
                <div>
                  <h2 className="text-4xl font-black text-blue-950 mb-4 tracking-tight uppercase">Rekod Berjaya Dihantar!</h2>
                  <p className="font-bold text-slate-500 text-lg max-w-md mx-auto leading-relaxed">Laporan PDF telah disimpan ke Google Drive dan data telah dikemaskini dalam Spreadsheet.</p>
                </div>
                <div className="flex flex-col md:flex-row gap-4 justify-center">
                  <button onClick={handlePreviu} className="bg-blue-50 text-blue-950 px-12 py-5 rounded-2xl font-black uppercase text-xs shadow-lg hover:bg-blue-100 transition-all">üëÅÔ∏è Previu PDF</button>
                  <button onClick={() => setView('form')} className="bg-blue-950 text-yellow-400 px-12 py-5 rounded-2xl font-black uppercase text-xs shadow-lg hover:bg-blue-900 transition-all">‚úèÔ∏è Edit Rekod</button>
                  <button onClick={resetBorang} className="bg-white border-2 border-slate-200 text-slate-400 px-12 py-5 rounded-2xl font-black uppercase text-xs hover:border-blue-950 hover:text-blue-950 transition-all">Borang Baru</button>
                </div>
              </div>
            )}
          </main>

          <div className="fixed bottom-10 right-10 flex flex-col items-end gap-6 z-[100]">
             {isAdmin && (
              <div className="bg-white p-8 rounded-[2.5rem] shadow-2xl border border-blue-100 w-80 mb-2 animate-fade-in">
                <div className="flex justify-between items-center mb-6 border-b pb-4 border-slate-100">
                   <h3 className="text-sm font-black text-blue-950 uppercase tracking-widest">Admin Panel</h3>
                   <button onClick={() => setIsAdmin(false)} className="text-red-400 font-bold hover:scale-110 transition-all p-2 bg-red-50 rounded-full w-8 h-8 flex items-center justify-center">√ó</button>
                </div>
                <div className="space-y-6">
                  <div className="bg-blue-50/50 p-6 rounded-[2rem] border border-blue-100 text-center">
                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">JUMLAH PENGHANTARAN</p>
                    <p className="text-5xl font-black text-blue-950">{totalSubmissions}</p>
                  </div>
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-slate-400 uppercase ml-2">Endpoint Apps Script</label>
                    <input className="w-full text-[10px] border-2 border-slate-100 p-4 rounded-2xl bg-slate-50 font-mono outline-none focus:border-blue-300" value={scriptUrl} onChange={e => setScriptUrl(e.target.value)} />
                  </div>
                  <a href={`https://docs.google.com/spreadsheets/d/${DEFAULT_SPREADSHEET_ID}`} target="_blank" className="block text-center bg-emerald-500 text-white py-5 rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-xl hover:bg-emerald-600 transition-all">
                      üìä Buka Google Sheets
                  </a>
                </div>
              </div>
            )}
            <button onClick={() => !isAdmin ? setShowLogin(true) : setIsAdmin(!isAdmin)} className="bg-blue-950 text-white shadow-2xl w-44 h-16 rounded-full flex items-center justify-center gap-3 transition-all hover:scale-110 px-8 border-4 border-white font-black text-sm uppercase">ADMIN</button>
          </div>

          {showLogin && (
            <div className="fixed inset-0 bg-blue-950/70 backdrop-blur-lg z-[200] flex items-center justify-center p-6">
              <div className="bg-white p-12 rounded-[3.5rem] shadow-2xl w-full max-w-sm animate-fade-in border-8 border-slate-50/50 text-center">
                <h3 className="font-black text-3xl text-blue-950 uppercase tracking-tight mb-8">Log Masuk</h3>
                <input autoFocus type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" className="input-field mb-8 text-center text-3xl tracking-[0.5em]" value={password} onChange={e => setPassword(e.target.value)} onKeyPress={e => e.key === 'Enter' && loginAdmin()} />
                <button onClick={loginAdmin} className="w-full bg-blue-950 text-yellow-400 py-6 rounded-3xl font-black uppercase shadow-2xl tracking-widest">Masuk</button>
                <button onClick={() => { setShowLogin(false); setPassword(''); }} className="w-full text-slate-400 font-bold uppercase text-[11px] mt-4">Kembali</button>
              </div>
            </div>
          )}

          <footer className="text-center p-16 text-slate-300 text-[10px] font-black uppercase tracking-[0.5em]">
            SJKC CHI CHIH - Sistem Rekod Pengurusan Kokurikulum ¬© 2026
          </footer>
        </div>
      );
    };

    const InputWrapper = ({ label, children }) => (
      <div className="space-y-3"><label className="text-[11px] font-black text-slate-500 uppercase tracking-widest ml-4">{label}</label>{children}</div>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
